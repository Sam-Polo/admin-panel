# Панель управления SportYugra

## Структура проекта

```
admin-panel/
├── index.html          # главная страница с таблицами и модальными окнами
├── admin1.js          # основной js файл с логикой панели управления
├── auth.js            # логика авторизации
├── firebase-config.js # конфигурация Firebase
├── styles.css         # стили
├── set-custom-claims.js  # скрипт для установки ролей
├── firestore.rules    # правила безопасности Firestore
└── serviceAccountKey.json  # ключ для админки Firebase
```

## Роли пользователей

### Админ
- Полный доступ ко всем объектам
- Управление пользователями
- Управление тегами
- Доступ к разделу "Пользователи"

### Модератор
- Доступ только к назначенным объектам
- Управление тегами назначенных объектов
- Нет доступа к управлению пользователями

## Структура данных Firestore

### Коллекция sportobjects
```javascript
{
  name: string,
  description: string,      // название объекта
  address: string,
  phone: string,
  location: geopoint,
  photo-urls: array[string]   // адрес
  tags: array[reference],    // массив ссылок на теги
  // другие поля объекта
}
```

### Коллекция tags
```javascript
{
  name: string,           // название тега
  parent: reference,      // ссылка на родительский тег (опционально)
  childrenTags: array     // массив дочерних тегов (опционально)
}
```

### Коллекция users
```javascript
{
  email: string,     // email пользователя
  admin: boolean,    // является ли админом
  objectIds: string[] // массив ID доступных объектов (для модераторов)
}
```

## Иерархия тегов

Теги в системе организованы в иерархическую структуру:
1. Теги загружаются из Firestore с сортировкой по имени (`orderBy("name")`)
2. Дерево тегов строится рекурсивно с глубинным обходом
3. На каждом уровне иерархии теги сортируются по имени
4. Порядок отображения тегов в админ-панели соответствует порядку в мобильном приложении

## Custom Claims

Для установки ролей используются Custom Claims:

### Админ
```javascript
{
  admin: true
}
```

### Модератор
```javascript
{
  moderator: true,
  objectIds: ['id1', 'id2'] // массив ID доступных объектов
}
```

## Интерфейс

### Таблица объектов
- Отображение списка объектов
- Для админа - все объекты
- Для модератора - только назначенные объекты
- Кнопки действий: редактирование, управление тегами, удаление

### Управление тегами
- Древовидное отображение тегов с чекбоксами
- Сортировка тегов по имени на всех уровнях иерархии
- Отображение выбранных тегов для добавления/удаления
- Сохранение изменений с подтверждением

### Таблица пользователей (только для админа)
- Отображение списка пользователей
- Управление ролями (админ/модератор)
- Назначение объектов модераторам
- Удаление пользователей

## Правила безопасности

- Админ имеет полный доступ ко всем объектам
- Модератор имеет доступ только к назначенным объектам
- Теги доступны для чтения всем авторизованным пользователям
- Управление тегами доступно только админу

## Разработка

1. Установка зависимостей:
```bash
npm install
```

2. Настройка Firebase:
- Создать проект в Firebase Console
- Включить Authentication и Firestore
- Скачать serviceAccountKey.json и положить в корень проекта

3. Установка ролей:
```bash
node set-custom-claims.js
```

4. Запуск:
```bash
firebase serve
```

## Деплой

```bash
firebase deploy
``` 